<NumberField>:
    canvas.before:
        # background rect
        Color:
            rgba: self.background_color
        Rectangle:
            size: self.width, self.height
            pos: self.pos

        # highlight rect
        Color:
            rgba: self.highlight_color
        Rectangle:
            size: self.width, self.height
            pos: self.pos

        # bottom line
        Color:
            rgba: self.bottom_border_color
        Line:
            width: self.bottom_border_width
            points: self.x, self.y, self.x + self.width, self.y

        # left line
        Color:
            rgba: self.left_border_color
        
        Line:
            width: self.left_border_width
            points: self.x, self.y, self.x, self.y + self.height

    halign: "center"
    valign: "middle"
    color: 0, 0, 0, 1
    font_size: "27sp"

<SudokuWidget>:
    orientation: "vertical"
    grid: grid
    info_label: info_label

    BoxLayout:
        orientation: "horizontal"
        size_hint: (1, 0.4)

        Label:
            size_hint: (0.8, 1)
            halign: 'left' # is ignored
            text: "Sudoku"

        # Settings button
        Button:
            # size_hint: (0.2, 1)
            text: "Kivy\nSettings"
            halign: "center"
            on_press: app.open_settings()

        # Help Dropdown:
        BoxLayout:
            size_hint: (0.2, 1)
        
            Button:
                id: help_button
                # size_hint: (0.2, 1)
                text: "Help"
                on_release: help_dropdown.open(self)
                size_hint_y: None
                height: self.parent.height

            DropDown:
                id: help_dropdown
                on_parent: self.dismiss()

                Button:
                    font_size: "9sp"
                    text: "* 2 3\n4 5 6\n7 8 9"
                    size_hint_y: None
                    height: help_button.height
                    on_release: grid.auto_candidates(), help_dropdown.select(self)

                Button:
                    text: "Solve\nfield"
                    size_hint_y: None
                    height: help_button.height
                    on_release: grid.solve_field(), help_dropdown.select(self)

                Button:
                    text: "Solve\nall"
                    size_hint_y: None
                    height: help_button.height
                    on_release: grid.solve(), help_dropdown.select(self)
        
        # Settings Button
        # Button:
            # text: "Settings"
            # on_release: app.open_settings()

        # Menu DropDown
        BoxLayout:
            size_hint: (0.2, 1)

            Button:
                id: menu_button
                # size_hint: (0.2, 1)
                text: "Menu"
                on_release: menu_dropdown.open(self)
                size_hint_y: None
                height: self.parent.height

            DropDown:
                id: menu_dropdown
                on_parent: self.dismiss()

                Button:
                    text: "Clear"
                    size_hint_y: None
                    height: menu_button.height
                    on_release: grid.clear(), menu_dropdown.select(self)

                Button:
                    text: "New"
                    size_hint_y: None
                    height: menu_button.height
                    on_release: grid.new_sudoku(), menu_dropdown.select(self)

                Button:
                    text: "Custom"
                    size_hint_y: None
                    height: menu_button.height
                    on_release: grid.edit_custom_sudoku(), menu_dropdown.select(self)

    SudokuGrid:
        id: grid
        size_hint: (None, None)
        width: self.parent.width
        height: self.width

    # Slider:
        # min: -1
        # max: 0
        # value: 0
        # step: 1
        # size_hint: (1, 0.2)

    BoxLayout:
        orientation: "horizontal"
        size_hint: (1, 0.2)

        NumberButton:
            text: "1"
            on_press: grid.enter_number(int(self.text))
        NumberButton:
            text: "2"
            on_press: grid.enter_number(int(self.text))
        NumberButton:
            text: "3"
            on_press: grid.enter_number(int(self.text))
        NumberButton:
            text: "4"
            on_press: grid.enter_number(int(self.text))
        NumberButton:
            text: "5"
            on_press: grid.enter_number(int(self.text))
        NumberButton:
            text: "6"
            on_press: grid.enter_number(int(self.text))
        NumberButton:
            text: "7"
            on_press: grid.enter_number(int(self.text))
        NumberButton:
            text: "8"
            on_press: grid.enter_number(int(self.text))
        NumberButton:
            text: "9"
            on_press: grid.enter_number(int(self.text))
        NumberButton:
            text: " "
            on_press: grid.enter_number(0)

    Label:
        size_hint: (1, 0.4)
        id: info_label
        # text: "Hint: double tap a field to edit candidates."

<NumberButton@Button>:
    size_hint: (1.0 / len(self.parent.children), 1)

<WinPopup>:
    title: "Sudoku complete"

    BoxLayout:
        orientation: "vertical"

        Label:
            size_hint_y: 0.8
            text: "Congratulations, you have won!"

        BoxLayout:
            size_hint_y: 0.2
            orientation: "horizontal"

            Button:
                text: "Back"
                on_release: root.dismiss()

            Button:
                text: 'New Sudoku'
                on_release: root.dismiss(), root.grid.new_sudoku()

<CustomWarningPopup>:
    title: "Warning: Sudoku is not unique"

    BoxLayout:
        orientation: "vertical"

        Label:
            size_hint_y: 0.8
            text: "Your Sudoku has multiple solutions."

        BoxLayout:
            size_hint_y: 0.2
            orientation: "horizontal"

            Button:
                text: "Back"
                on_release: root.dismiss()

            Button:
                text: 'Play anyway!'
                on_release: root.dismiss(), root.grid.end_edit_custom_sudoku()

<CustomErrorPopup>:
    title: "Error: Sudoku is not valid."

    BoxLayout:
        orientation: "vertical"

        Label:
            size_hint_y: 0.8
            text: "Your Sudoku has no solution."

        Button:
            size_hint_y: 0.2
            text: "Back."
            on_release: root.dismiss()

<NumberChooser>:
    rows: 3
    cols: 4

    NumberChooserButton:
        text: "1"

    NumberChooserButton:
        text: "2"

    NumberChooserButton:
        text: "3"

    NumberChooserButton:
        text: "4"

    NumberChooserButton:
        text: "5"

    NumberChooserButton:
        text: "6"

    NumberChooserButton:
        text: "7"

    NumberChooserButton:
        text: "8"

    NumberChooserButton:
        text: "9"

    NumberChooserButton:
        text: ""
        on_release: self.parent.callback(None)

    NumberChooserButton:
        text: "1 2 3\n4 5 6\n7 8 9"
        font_size: self.parent.candidate_font_size
        on_release: self.parent.callback([1, 2, 3, 4, 5, 6, 7, 8, 9])

<NumberChooserButton@Button>:
    size_hint: None, None
    size: self.parent.field.size
    font_size: self.parent.number_font_size
    background_normal: ''
    background_color: (0, 0, 1, 1)
    on_release: self.parent.callback(int(self.text))